function [y1,xf1] = myNeuralNetworkFunction(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 27-Apr-2017 15:01:20.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 24xTS matrix, input #1
%   xi1 = 24x1 matrix, initial 1 delay states for input #1.
% and returns:
%   y1 = 24xTS matrix, output #1
%   xf1 = 24x1 matrix, final 1 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.761973256854406;-0.391804755201634;-12.1212528153389;-2.0999150194759;-0.468848694923593;-0.948088181180535;-0.310032863289832;-0.560322744400975;-1.86890135285225;-0.294729404918017;-0.786587714053331;-2.20204466365142;-0.323878691287462;-1.12478221434753;-0.312974283576734;-0.429547048440832;-1.15145934905925;-0.304020128720736;-0.601920632543932;-2.2339157245139;-0.356305255623977;-0.951831563844283;-0.422366445924614;-0.418748617350512];
x1_step1.gain = [0.0191077587253216;0.0193701268562642;0.0174837530785599;0.0182042609095746;0.018978784218706;0.0190587972067361;0.019376896867127;0.0194148334364715;0.0192780469824224;0.0195780948955053;0.0196202222394189;0.0193226794075807;0.0195593774303623;0.0190842534314399;0.0194436045857507;0.0196977061224042;0.0193346604303608;0.0197488051826484;0.0191171587611852;0.0184127829132413;0.0192107168234946;0.0189673652763731;0.0189660496470193;0.0189825859824286];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.092087591300228963109;0.028792924192941930783;-0.026823029082105796089;-0.086104884992183286507;-0.054105163200860208195;0.10901627382683691525;0.043847877226312323429;-0.19859972183209967378];
IW1_1 = [-0.27356617267172100849 -0.15276073811458174001 0.017619036858852951677 -0.0021024719739688450988 0.0148550354923081291 -0.22024203787724680459 -0.36275500843857677591 -0.093383238798843651307 0.082463672333717361052 0.30338008227359103408 0.32038621952887491595 -0.052076144084404162038 -0.14002731302831414317 -0.061416538125869654663 -0.13932133999041815264 -0.1877649536402285213 -0.23718805847336851822 -0.28311259345144967892 -0.46192234132598453122 0.24981434347469622104 0.22345257421793299213 -0.025631068378412950187 -0.29576369070024749464 -0.15961427657046692308;-0.43412655749441464437 0.16525795094131565111 0.15987315791327050274 -0.30628276229874806802 -0.28247171916441754513 0.11857243355346697156 0.12538257918099854349 -0.35406618115135024549 -0.42132626181289523082 -0.12552928505355770428 -0.2266270997697096834 -0.14658946894082761081 0.29115046920614279236 0.10735978518395394854 -0.14005507585104187696 -0.19041468445339354565 -0.11466334974617913012 -0.0026551539703586657555 0.029353099931643165943 -0.72777808543072164404 -0.34137669914907425861 0.27067364413024330716 -0.33423586267424443275 0.21127039420009408044;-0.18826755308607939776 -0.22026288972368637809 -0.026761997202416117764 0.25045230666570678091 0.071296214649321343337 0.14867624228233014549 0.1554282153677389311 -0.29359218057081870601 -0.35099939469592789099 -0.17865048890569540374 -0.16185613490343719878 -0.23666115481729757541 -0.14832614673450503218 -0.17569378567906190902 0.30870535444227120703 0.30881743950910850449 0.033284923538975740021 0.01773588266189047441 -0.0072560948704499623682 -0.71945149840083078008 -0.3491753417829989159 0.22906858336112795316 -0.085726963118556320786 -0.24526039124901838351;-0.16214004913383045503 0.19159531227045648039 0.67795254880390698471 0.37262455109826120303 0.11440391114024349439 -0.13804506747581718473 -0.22397110538469941488 -0.23283316191160133291 -0.090300152740145550601 0.047409894852697552492 -0.21997772691723890826 -0.14812013104169044486 0.10487491981131796814 0.27511628226714851531 0.21291238629066830401 0.19003578536463963666 -0.18134240796169520671 -0.096238364353477823254 -0.1541216054386449763 -0.17684375512630373661 -0.20005490939654371751 -0.18308505919573164755 -0.030464450385172991281 0.18743416919683147936;-0.015161610438563594139 -0.050648978878318193231 0.015165619270681747824 -0.050453202068082743381 -0.074500081765988213078 -0.32728910251049742053 -0.39089256826098733866 -0.17695633300298055368 -0.32394379245433990722 -0.21862556362099885843 -0.19390410598742757742 -0.046678313054971706797 -0.1278848158196414786 -0.011826285554607730149 0.0043608110585193534531 0.00055112259578394813628 0.12718109705690158751 0.26892193841964284751 0.1488629977397704085 0.61725665472285895508 0.34389771061336937841 -0.015662152036654899967 -0.0028874760704213171467 -0.021737058291061896881;-0.025070043766277565894 -0.010135412316254413176 0.063810306090991392169 0.10585794005205743928 0.27384451321917030464 0.35193291327941500501 0.35302272316732130619 0.3220285218430375962 0.071988141353164530889 0.038245677558792615103 -0.002848522141637668207 -0.040398159342080679213 -0.04297329489696149335 -0.11886297275821233743 -0.17747981654789340977 -0.19681698047262444207 -0.10832969430770313102 -0.098953166981164658589 -0.12863706155820447963 0.010850362016605340915 -0.006219845874051753605 -0.026303400487173996675 -0.012018038021207098562 0.014352519862548981239;-0.16583672168614516096 -0.31339103466826900846 -0.12072156487695605287 -0.41999262602892173391 -0.26636450796412347586 -0.0083074895328501315722 -0.016429816191465891617 -0.0098140479886896069689 0.0085393235373651225906 -0.034209844049406627764 -0.047545616850703707745 0.098436911857145800719 0.31758904494516282391 0.15417796240193434865 0.28742119320722581133 0.25394010635026958989 0.031485187437983265524 -0.013192764205616280132 -0.024450654960788211628 -0.011891326856238363871 -0.020969035896990461526 -0.022876222267385299541 -0.11803430956011505548 -0.34506927335749876251;-0.24516603146764393006 -0.10660973318508647212 -0.029677510480245923585 0.016032626576940212093 0.018879012355166268494 0.016358275380275802413 0.076388875367091005342 0.21806092640981802888 0.25664485833863415198 0.22918713641088592214 0.12453641762572355278 0.21050416777845090688 0.15847341911971457584 0.17739740314701421542 0.012182366560464655617 0.025594640652740738296 0.030539250081961021727 0.042138877132723850938 -0.0035016027041804070538 -0.085377321688856283588 -0.2964181054419151029 -0.49939471501201365689 -0.22495877144377945944 -0.079811023610873332856];

% Layer 2
b2 = [0.082958313255282620235;0.073501219429723332888;0.21177185867470266212;-0.044707256633179072447;0.088301312623542099756;0.13046017047265245914;0.031954997892321319874;0.087425782268403931519;0.087496699673285452392;-0.068683186781956520606;-0.0080641786641590575829;0.14051191365914414422;0.10147247205062848163;0.029413790596660209509;-0.053850362454141244284;0.00076515073107455151401;0.021732335086825701337;-0.054061360710413459973;-0.070200163427825562623;-0.034176509763055126778;-0.093140832490303748781;-0.048311858110549950329;0.048834245959390426561;0.078490848572068380729];
LW2_1 = [-0.1583600234934838813 0.20654914291529111181 -0.34254485319196270598 0.48954087327115813899 -0.01736340779465565809 0.12403301371504468764 -0.48503508987313104228 -0.17422635954747348053;0.01673814853866102681 -0.089452225692700074178 0.062155172562672306169 0.39025597821941521159 0.030244781189101531405 0.18487442499483638936 -0.65500733894302221039 -0.030727749362033717623;-0.0016368003624535778888 -0.31337794715040884208 0.33128124389040342068 0.25269621514379747573 0.020923772002228169242 0.38220686852746654782 -0.49270216301077751631 0.06716880490567553319;-0.067194522679162121959 -0.019708382815513660058 0.062834349835549724306 -0.070907935347953532368 -0.20680373846347030464 0.78559377841987887425 0.012855512252123509065 -0.0034438722244559140905;-0.25739070671071700991 0.099163273204736362976 0.12358337478427931788 -0.24801025559713094082 -0.39784027446994302268 0.64934699306327825497 -0.13137123065627512308 0.097934747492877144426;-0.31198800004067006597 0.13471457914273368695 0.13049553281804976423 -0.30524186670468383964 -0.48930403879300232717 0.5658004785854252594 -0.17236197832276645148 0.11884033861330883797;0.013189902928538815158 0.037505165825557136572 0.090769959812014189282 -0.099571124858425577586 -0.92194252065690296405 0.1185721132712377196 -0.0062083350096043179306 -0.11196203779867117123;0.2916575951397222255 0.25417975345559817857 0.2365896290138631286 -0.1785777573845924171 -0.8478519029984800115 0.032496594840397026449 -0.049363835797059385513 -0.24831934491526280739;0.54029580751039296693 0.57040151962360130522 0.39111831958912485208 -0.15738280888864494833 -0.60961570220431982037 -0.057873293566243252939 -0.13334299325095419486 -0.1749494752721924562;0.22607494170589292892 0.54404304241845924395 0.40849792667305429017 -0.036065192973358209394 -0.32248481590598121471 0.1224059981483323345 0.024230471424660494223 0.07892518324842683064;-0.032840377738469296587 0.78070088253244052101 0.22873652417648013269 0.20874885787553976169 -0.21003583732689709573 0.17026462190197397262 0.26337844361627293921 0.10079471086327576601;-0.042703550198322802467 0.79642448686467881558 0.20385015743510881414 0.48641955281136373124 -0.13036684070638793198 0.066700684096092643927 0.26703096836869089081 0.015979240386043733896;-0.22576660883782892486 0.32957673546078691817 0.52844306147238429006 0.61614393777477671765 -0.17258235186549564233 -0.14104355646918620426 0.20730432340434812311 -0.0060190053142103894929;-0.24480179145242964012 0.066344502917523001662 0.78482984221111340428 0.55053645943360707271 -0.17786187222801322361 -0.21003049416394395377 0.31502686069893559573 -0.20379614459623124345;-0.47426674777345584344 0.25874155520166314259 0.44247393979601518099 0.069401721451639961091 -0.26792825142913784253 -0.52196825059844897954 0.13021685073607683347 -0.2838834756674151194;-0.59444902067717952932 0.38976651917252080892 0.4560456065779637802 -0.14198688507544135473 0.010649539079319789853 -0.3080905892074594643 -0.07345351687814441477 -0.18998390571022014117;-0.62044979362724583805 0.44348276997390678744 0.3123816443386724373 -0.27169561876053688332 0.12458131793192935011 -0.24330764609064678416 -0.29506424315005985726 -0.22398374246116148356;-0.44279097175873483039 0.18718142366557760647 0.19077110011406389622 -0.099336143163964496505 0.30569406662531933838 0.061146002540132374237 -0.13239049329758409423 -0.44111965947747350247;-0.11639059178614290235 0.0088249542848829604091 0.085211313706463190365 -0.049873743531413737562 0.16835734384522935136 0.068064539451896291511 -0.11175283809418258552 -0.72750007897963930859;0.023266390377506981912 -0.046942222427589275213 0.033017102611009707669 -0.079037786407571128389 -0.012418148917992252039 -0.022601395775786660425 -0.13939015852008929119 -0.86057890733184960741;-0.18790692731096231283 -0.20618001486012796364 -0.067812755529656154607 0.012656152412022015838 -0.083422176212953141894 -0.0095809241753034690009 -0.1070765069702332567 -0.74601928439931297632;-0.3653429874159903612 -0.17366971439350481488 -0.39119631646769503774 0.23217556413635975776 -0.20090907275673505761 -0.058765535817976395638 -0.20107706846086764729 -0.42725571209064167055;-0.13298388653933301828 0.1294628908445413229 -0.31611926880375618154 0.38162446108065817274 -0.081049583776436409654 -0.017139026078125292607 -0.62073201916779097154 -0.14849282120790466277;0.055845834584448722504 -0.077511586202756749264 0.04430494638616407771 0.36667111542271785263 0.010478436221343194468 0.14499459013039422972 -0.73155877712850980732 -0.00090193974937631722372];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.0191077587253216;0.0193701268562642;0.0174837530785599;0.0182042609095746;0.018978784218706;0.0190587972067361;0.019376896867127;0.0194148334364715;0.0192780469824224;0.0195780948955053;0.0196202222394189;0.0193226794075807;0.0195593774303623;0.0190842534314399;0.0194436045857507;0.0196977061224042;0.0193346604303608;0.0197488051826484;0.0191171587611852;0.0184127829132413;0.0192107168234946;0.0189673652763731;0.0189660496470193;0.0189825859824286];
y1_step1.xoffset = [-0.761973256854406;-0.391804755201634;-12.1212528153389;-2.0999150194759;-0.468848694923593;-0.948088181180535;-0.310032863289832;-0.560322744400975;-1.86890135285225;-0.294729404918017;-0.786587714053331;-2.20204466365142;-0.323878691287462;-1.12478221434753;-0.312974283576734;-0.429547048440832;-1.15145934905925;-0.304020128720736;-0.601920632543932;-2.2339157245139;-0.356305255623977;-0.951831563844283;-0.422366445924614;-0.418748617350512];

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(24,1)];

% Allocate Outputs
y1 = zeros(24,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+0,2)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-1-1,2)+1),24,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 1);
xits = finalxts(finalxts<=1);
xts = finalxts(finalxts>1)-1;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
