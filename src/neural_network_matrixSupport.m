function [y1,xf1] = neural_network_matrixSupport(x1,xi1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 18-Apr-2017 21:05:19.
%
% [y1,xf1] = myNeuralNetworkFunction(x1,xi1) takes these arguments:
%   x1 = 24xTS matrix, input #1
%   xi1 = 24x1 matrix, initial 1 delay states for input #1.
% and returns:
%   y1 = 24xTS matrix, output #1
%   xf1 = 24x1 matrix, final 1 delay states for input #1.
% where TS is the number of timesteps.

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.761973256854406;-0.391804755201634;-12.1212528153389;-2.0999150194759;-0.468848694923593;-0.948088181180535;-0.310032863289832;-0.560322744400975;-1.86890135285225;-0.294729404918017;-0.786587714053331;-2.20204466365142;-0.323878691287462;-1.12478221434753;-0.312974283576734;-0.429547048440832;-1.15145934905925;-0.304020128720736;-0.601920632543932;-2.2339157245139;-0.356305255623977;-0.951831563844283;-0.422366445924614;-0.418748617350512];
x1_step1.gain = [0.0191077587253216;0.0193701268562642;0.0174837530785599;0.0182042609095746;0.018978784218706;0.0190587972067361;0.019376896867127;0.0194148334364715;0.0192780469824224;0.0195780948955053;0.0196202222394189;0.0193226794075807;0.0195593774303623;0.0190842534314399;0.0194436045857507;0.0196977061224042;0.0193346604303608;0.0197488051826484;0.0191171587611852;0.0184127829132413;0.0192107168234946;0.0189673652763731;0.0189660496470193;0.0189825859824286];
x1_step1.ymin = -1;

% Layer 1
b1 = [0.0057357876132949356732;0.10539903544735891583;0.072045328497130189938;-0.045362299548120481318;-0.089020925584420221299;-0.11175181822141562471;0.016245299418430662886;-0.029405993063785922786];
IW1_1 = [0.047276421484902721171 -0.14933760532138917743 -0.35736717412272228644 -0.43160404390471884817 -0.038047240023594067204 0.41319546835515946759 0.11370810949263235323 0.033299529824378767962 -0.2190735644944533933 -0.13136657436017096234 0.054165027730983264509 0.13448296592114850068 0.11593614306865916708 -0.23550513337245265744 -0.24016502450959528736 -0.010889121197050013329 0.35492513175802686831 0.36167044522945451801 0.21213720204461639085 0.030026505940776184594 0.013368907119277267936 0.0017793439883413923047 -0.019134063606923917139 -0.13643668322333465937;-0.15141442046678263433 -0.25519402266871271667 -0.17001934470668228494 -0.093996914989490781833 -0.076094985925647326552 -0.060844593281200252954 -0.01094749570945877104 -0.0048063760328164104041 -0.025688805949400317363 -0.008206712850189109773 0.10868192113684656264 0.17539136285441531138 0.25198148249044372005 0.32720449842505883176 0.20777607925181476589 0.12992550112487502578 0.0011804559094094248944 -0.019960271599798493775 -0.041886317056421512595 -0.023189854027665220138 -0.031548755762603408748 -0.12853471969475979697 -0.21830312401700788238 -0.30060639443734910037;-0.30608844981933897023 -0.28301715480440226003 0.057837800747437780047 0.22623695294550502655 0.10448396589882441576 -0.037850965448459103491 -0.10921724706963396867 -0.095990739521338755424 -0.0018821067137779839105 0.010306160794441791839 -0.12608708208901991954 -0.24329908096470068135 -0.24926952012658223912 -0.092315187691149963589 0.32799277438752211244 0.3848354315035570905 0.13324552540398137968 0.06630731531381531263 -0.00098877883977119534337 -0.088745347635052998503 -0.090773304863394299602 -0.12345396264773061956 -0.19924840845857202942 -0.30185206109225048987;-0.27202645692998284055 0.18138515498865762088 0.37531081985728131922 0.39391250260907606506 0.183672175133326121 -0.075059314206558008786 -0.088004497110429527607 -0.15274418242297083115 -0.4258683126078650627 -0.070405034409212516322 -0.11025961303966759497 -0.079949584094061443285 0.020438022701704826323 0.3044746275892946108 -0.11256826126465192817 -0.12380052061129007135 0.01634037813989654836 0.3121719433383412512 0.12441839635529339247 -0.08828964600965892584 -0.15352717016922001747 -0.29202441687891761424 -0.25306129582520270338 0.22800942500064053098;-0.18580234367378004046 -0.074271568459538139795 -0.0054717732292360711857 0.016047682857660953287 0.0021963873983073577481 0.036770299622812564755 0.063734118058976566012 0.068864067703315823277 0.13562498143836285158 0.053693746102213682492 -0.048198781871746261551 0.41820110077745642485 0.20741900237652355354 -0.043751197616785475475 -0.058777368762967317772 -0.052819125098984821831 -0.064543976845404457676 -0.048095067524439691353 -0.008928958716951977681 -0.24408270578553545316 -0.51036879109710198144 -0.35818828236964855849 -0.12756209395354659031 -0.0089806522367191238959;-0.028543381155581346031 -0.019851365531188960162 -0.084777599271628659161 -0.15429276537480621223 -0.44127113290359026854 -0.47875625522153736346 -0.24346949743960588641 -0.20652118350602424734 -0.06683036631338465372 -0.041348799926068234567 -0.022330463125904621846 0.034652044827322127374 0.040450314378577441332 0.12838091886702673872 0.14513520529670154158 0.07828133360436871635 0.0060967277958301384702 0.21452044256472438399 0.31834580166762588282 -0.020145591506834290701 -0.017601009194647205397 -0.0069812423055273017253 -0.0072435079715744239356 -0.02142098063909325667;-0.13409569784358740807 -0.039269092759794975434 -0.0083861657094541439822 0.0052798934808312306469 0.01585330259467052777 0.071772851817546265418 0.11712700415606407123 0.1281041906122805385 0.1555777376899345199 0.38894474556575076019 0.44637741170091838061 -0.011206410574431087748 -0.0014854759176897321376 -0.0036631014122436695267 -0.017796750632867907455 -0.013957606824957138197 -0.015287331441287785316 -0.047268265137216165794 -0.26409176593878641581 -0.39631655220012790286 -0.19688210031818473289 -0.11838717498316625454 -0.11033904943824417166 -0.028337484292375467176;0.27063421440736445955 0.14430405832852855053 0.090983208783400174036 0.066729444351579847439 0.13557941278208704428 -0.029744730463674904503 -0.35520388241277078833 -0.36442379813169822889 -0.26003314223487639101 -0.0024026664324316104014 0.20862463165945474564 0.21271437268376217067 0.097646123924481922907 -0.010302738098368121461 0.039975324502223408274 0.14292000485484634975 0.15317934946092232051 -0.041789041083396337439 -0.32780794593494494427 -0.073184809197913841539 -0.042758766581558256548 0.097235373916195175226 0.21738388240538958351 0.13844675073375034557];

% Layer 2
b2 = [0.10849641421432308641;0.16375947343538593826;0.30674570007591911436;0.041070642047529498653;0.19086902981070180685;0.19816214900873929672;0.112800474568383019;0.095680492442299133748;0.020517316106560934408;-0.052336057432563427849;-0.021744728920100049596;-0.088594371882311728772;-0.04042271336695282824;-0.021836871531137235641;0.088439863933681792107;0.13075459875873646221;0.16894136595921360744;0.039730188090985843474;-0.045831335015641572195;0.020489509755570255167;0.11398002919434657709;0.23892094118132878311;0.13759712205276064534;0.17779708665497076514];
LW2_1 = [-0.26579298143543361732 -0.51514733672245638374 -0.30380340286106216618 0.42906120516171808443 0.0062193940783364688729 -0.068145049033447660514 0.096412580987212823103 0.039675974565997099153;-0.4265944393964071768 -0.42528429977897913572 -0.066812742383586171124 0.43643578606746458171 -0.034384856355279221074 -0.17350489167708857408 0.064798145615955149434 0.055399286503484405919;-0.27863777763435798596 -0.30684810475757490211 0.20285216905968417311 0.25084616613741889113 -0.023325943238399822477 -0.45391161279494690595 0.024797788466674925562 0.10810379782868934084;0.23307842402765338585 -0.15339623240150959682 0.070870935711143751012 -0.019296833419932411108 0.038774677568242592318 -0.83618427878087664418 0.15224356878883732458 -0.017425842533864699391;0.22458820826070280408 -0.25500913950399178853 -0.051670356626689825652 -0.063015316133281013 0.12549415125310409147 -0.4411694076111142282 0.27770280423901694267 -0.4048974335547635417;0.06683797396117771572 -0.2309995058662827061 -0.19767093854233144801 -0.18446099569435261967 0.17953797275503019515 -0.13855620741129717755 0.31462723797133529402 -0.67197311129198744606;-0.30663415308531782877 -0.14349110631287401163 0.012597067827908130927 -0.4787757358966351906 0.23592426012707679028 -0.041766131304909193123 0.30797041120506224443 -0.43887983958301191034;-0.27763879233190918994 -0.1318564394070775303 0.037371820187190082918 -0.43481459113290543694 0.22236593566651161047 -0.010605867044535687363 0.42440431874685935476 -0.34730532524822610441;-0.005267004716411508719 -0.022681598816149357162 0.0030957566132135418656 -0.028951333630397060176 0.10294855713042345979 0.012618320461475632591 0.92467544402833823369 0.03897314368623969183;-0.01638242122176470153 0.030862941437675772 0.013634875125055226017 -0.024279500770505738072 0.60727171483067543534 -0.02058703548542810402 0.33537088094286521267 0.075362139748153117447;-0.016604273700205032099 0.068086804775768214326 -0.052209732352371786279 0.049186581563705165931 0.86507426945249954464 0.075810967232583181818 0.079735557428478529007 0.025523497823096055748;-0.2604081202340878809 0.55325511577217489911 0.11534752177264145923 0.44165522366290077549 0.12971450304050560765 0.16719122290609272907 0.16337623426632821855 -0.27968462392160275964;-0.4109810392711007454 0.27919654895346263102 0.49457850749161708093 0.27241346118711634583 0.097579250428218161639 0.3696558380999819815 0.066966330920083333433 -0.24484693116090067155;-0.21653972929117890067 0.005369544194148992422 0.89714208664418770844 0.087584301138391135177 0.013253230369504289538 0.25878430069214458653 -0.010064336441193894034 -0.046331966904188136291;0.35130901205020936828 -0.10547441940585863818 0.44976764570353999773 0.072946892118597936316 -0.028927994040537242243 0.46187161415616156956 0.0050652058220191529744 0.23522841664690360974;0.58670162008079784766 -0.22383817387574439506 0.26928469544672795077 0.26449945111951694843 -0.054663512549640927429 0.44028329320650005929 -0.0065680268213028471583 0.074255310248972916654;0.42768266451958125707 -0.30601694656605582523 0.0071057554704504390791 0.29072586183998766485 -0.032090752081210011104 0.56088859123874479362 -0.27594183748782119547 -0.24018067398107298405;0.10111234402237695429 -0.15163358437899229769 0.015428708647953969305 0.080153850868130468998 -0.097722215800797262997 0.17802728480705620751 -0.72634352857075334953 -0.19331576676265799231;-0.017059193531010010542 -0.070789660420645578176 0.0058151026981828829801 -0.012170533248498848974 -0.59554007362689054261 -0.0015112506496210318871 -0.37524494479475350994 -0.074518243620891461143;-0.0075206672216029070085 -0.21794651566118813935 -0.054536202413357562357 -0.14083056634240639915 -0.66897089368039830415 0.014498546349493752691 -0.092357586005639660809 0.063519365960558848982;0.016939342397407668867 -0.4634777412917720496 -0.13027024161298481064 -0.28722287444705080217 -0.31113902990388803138 0.025570395160733068451 -0.18959297148322615256 0.26588198259578615934;-0.10353511350430567861 -0.31051315158863079802 -0.40479840037206032965 -0.062004727001710037426 -0.12855968518176771886 0.060665435939961209755 -0.15825154447113748413 0.38357146623954785358;-0.2730594019894485025 -0.52447987621658764823 -0.32313137317342066623 0.40285392012942344842 0.0091975181578106759983 -0.011617531513691322503 0.060170957522677710749 0.11151607456516117456;-0.50065430521383846862 -0.38535527966472538086 -0.11202765649403180481 0.46018022457708895878 -0.014490941592041162861 -0.14705170382009724594 0.017432615247247054691 0.024059790136619185752];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.0191077587253216;0.0193701268562642;0.0174837530785599;0.0182042609095746;0.018978784218706;0.0190587972067361;0.019376896867127;0.0194148334364715;0.0192780469824224;0.0195780948955053;0.0196202222394189;0.0193226794075807;0.0195593774303623;0.0190842534314399;0.0194436045857507;0.0196977061224042;0.0193346604303608;0.0197488051826484;0.0191171587611852;0.0184127829132413;0.0192107168234946;0.0189673652763731;0.0189660496470193;0.0189825859824286];
y1_step1.xoffset = [-0.761973256854406;-0.391804755201634;-12.1212528153389;-2.0999150194759;-0.468848694923593;-0.948088181180535;-0.310032863289832;-0.560322744400975;-1.86890135285225;-0.294729404918017;-0.786587714053331;-2.20204466365142;-0.323878691287462;-1.12478221434753;-0.312974283576734;-0.429547048440832;-1.15145934905925;-0.304020128720736;-0.601920632543932;-2.2339157245139;-0.356305255623977;-0.951831563844283;-0.422366445924614;-0.418748617350512];

% ===== SIMULATION ========

% Dimensions
TS = size(x1,2); % timesteps

% Input 1 Delay States
xd1 = mapminmax_apply(xi1,x1_step1);
xd1 = [xd1 zeros(24,1)];

% Allocate Outputs
y1 = zeros(24,TS);

% Time loop
for ts=1:TS
    
    % Rotating delay state position
    xdts = mod(ts+0,2)+1;
    
    % Input 1
    xd1(:,xdts) = mapminmax_apply(x1(:,ts),x1_step1);
    
    % Layer 1
    tapdelay1 = reshape(xd1(:,mod(xdts-1-1,2)+1),24,1);
    a1 = tansig_apply(b1 + IW1_1*tapdelay1);
    
    % Layer 2
    a2 = b2 + LW2_1*a1;
    
    % Output 1
    y1(:,ts) = mapminmax_reverse(a2,y1_step1);
end

% Final delay states
finalxts = TS+(1: 1);
xits = finalxts(finalxts<=1);
xts = finalxts(finalxts>1)-1;
xf1 = [xi1(:,xits) x1(:,xts)];
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 1 ./ (1 + exp(-n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
